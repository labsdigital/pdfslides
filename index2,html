<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PDF Viewer Pro - Interactive Tool</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600&display=swap');
        
        body {
            font-family: 'Inter', sans-serif;
            background-color: #020617;
            color: #f8fafc;
            overflow: hidden;
            margin: 0;
            user-select: none;
        }

        /* Landing Screen Styling */
        #landing-screen {
            position: fixed;
            inset: 0;
            z-index: 2000;
            background: radial-gradient(circle at center, #0f172a 0%, #020617 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .glass-card {
            background: rgba(15, 23, 42, 0.7);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 24px;
            padding: 40px;
            width: 100%;
            max-width: 500px;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5);
        }

        /* Navigasi Samping */
        .nav-btn {
            position: fixed;
            top: 50%;
            transform: translateY(-50%);
            width: 50px;
            height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: rgba(30, 41, 59, 0.4);
            backdrop-filter: blur(8px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 50%;
            color: rgba(255, 255, 255, 0.6);
            cursor: pointer;
            transition: all 0.3s ease;
            z-index: 500; 
        }

        .nav-btn:hover {
            background: rgba(56, 189, 248, 0.3);
            color: #38bdf8;
            transform: translateY(-50%) scale(1.1);
        }

        .nav-btn.prev { left: 20px; }
        .nav-btn.next { right: 20px; }

        /* Floating Panels */
        .glass-panel {
            background: rgba(15, 23, 42, 0.6);
            backdrop-filter: blur(16px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.5);
            z-index: 600;
            position: fixed;
        }

        #annotation-container {
            top: 24px;
            left: 24px;
            display: flex;
            flex-direction: column;
            gap: 10px;
            z-index: 700;
        }

        .main-tool-btn {
            width: 48px;
            height: 48px;
            border-radius: 14px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s;
        }

        #color-palette {
            display: flex;
            flex-direction: column;
            gap: 8px;
            padding: 8px;
            border-radius: 14px;
            transform-origin: top;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            opacity: 0;
            transform: scale(0.8) translateY(-10px);
            pointer-events: none;
        }

        #color-palette.open {
            opacity: 1;
            transform: scale(1) translateY(0);
            pointer-events: auto;
        }

        #zoom-menu {
            bottom: 24px;
            right: 24px;
            align-items: center;
            padding: 8px;
            border-radius: 16px;
            display: flex;
            gap: 4px;
        }

        #pagination-panel {
            bottom: 24px;
            left: 50%;
            transform: translateX(-50%);
            align-items: center;
            padding: 8px 20px;
            font-size: 0.875rem;
            border-radius: 12px;
            display: flex;
        }

        .tool-btn {
            color: rgba(255, 255, 255, 0.5);
            transition: all 0.2s;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            width: 36px;
            height: 36px;
            border-radius: 10px;
        }

        .tool-btn:hover { color: #fff; background: rgba(255,255,255,0.1); }
        .tool-btn.active { color: #fff; background: rgba(255, 255, 255, 0.2); }

        .pen-dot {
            width: 16px;
            height: 16px;
            border-radius: 50%;
            border: 2px solid rgba(255,255,255,0.2);
            transition: transform 0.2s;
        }
        .pen-dot.active { transform: scale(1.25); border-color: white; box-shadow: 0 0 8px currentColor; }

        /* Viewer Area */
        #canvas-wrapper {
            position: relative;
            height: 100vh;
            width: 100vw;
            background-color: #000;
            overflow: auto;
            scrollbar-width: none;
        }
        
        #canvas-wrapper::-webkit-scrollbar { display: none; }

        #canvas-track {
            display: flex;
            height: 100%;
            width: 200%; 
            position: absolute;
            left: 0;
            top: 0;
        }

        .slide {
            width: 50%;
            min-height: 100%;
            display: flex;
            position: relative;
            flex-shrink: 0;
            padding: 40px;
            z-index: 1;
        }

        .container-rel {
            position: relative;
            margin: auto; 
            box-shadow: 0 0 100px rgba(0,0,0,0.8);
            border-radius: 4px;
            background-color: #fff;
            flex-shrink: 0;
        }

        canvas.pdf-canvas { display: block; border-radius: 4px; }
        canvas.draw-canvas {
            position: absolute;
            top: 0;
            left: 0;
            z-index: 5;
            cursor: crosshair;
            touch-action: none;
        }

        .cursor-pan { cursor: grab !important; }
        .cursor-pan:active { cursor: grabbing !important; }
        .transition-active { transition: transform 0.5s cubic-bezier(0.4, 0, 0.2, 1) !important; }

        /* Custom UI Components */
        .btn-primary {
            background: #38bdf8;
            color: #020617;
            padding: 12px 24px;
            border-radius: 12px;
            font-weight: 600;
            transition: all 0.3s;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            cursor: pointer;
        }
        .btn-primary:hover { background: #7dd3fc; transform: translateY(-2px); }

        .input-glass {
            background: rgba(255,255,255,0.05);
            border: 1px solid rgba(255,255,255,0.1);
            color: white;
            padding: 12px 16px;
            border-radius: 12px;
            width: 100%;
            outline: none;
            transition: border 0.3s;
        }
        .input-glass:focus { border-color: #38bdf8; }

        #loading-overlay {
            position: fixed;
            inset: 0;
            background: rgba(2, 6, 23, 0.8);
            backdrop-filter: blur(4px);
            z-index: 3000;
            display: none;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }

        .loader {
            border: 3px solid rgba(56, 189, 248, 0.1);
            border-top: 3px solid #38bdf8;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin-bottom: 16px;
        }
        @keyframes spin { 100% { transform: rotate(360deg); } }
    </style>
</head>
<body>

    <!-- Landing Screen -->
    <div id="landing-screen">
        <div class="glass-card text-center">
            <div class="mb-8">
                <div class="w-16 h-16 bg-sky-500/20 rounded-2xl flex items-center justify-center mx-auto mb-4">
                    <svg class="w-8 h-8 text-sky-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 21h10a2 2 0 002-2V9.414a1 1 0 00-.293-.707l-5.414-5.414A1 1 0 0012.586 3H7a2 2 0 00-2 2v14a2 2 0 002 2z"></path>
                    </svg>
                </div>
                <h1 class="text-2xl font-bold text-white mb-2">PDF Viewer Pro</h1>
                <p class="text-slate-400 text-sm">Pilih file lokal atau masukkan URL dokumen</p>
            </div>

            <div class="space-y-6">
                <!-- File Input -->
                <label class="block">
                    <span class="sr-only">Pilih File</span>
                    <input type="file" id="file-input" accept="application/pdf" class="hidden">
                    <div onclick="document.getElementById('file-input').click()" class="btn-primary w-full">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a2 2 0 002 2h12a2 2 0 002-2v-1m-4-8l-4-4m0 0L8 8m4-4v12"></path></svg>
                        Buka dari Komputer
                    </div>
                </label>

                <div class="flex items-center gap-4 py-2">
                    <div class="h-px flex-1 bg-white/10"></div>
                    <span class="text-xs text-slate-500 uppercase font-bold">Atau URL</span>
                    <div class="h-px flex-1 bg-white/10"></div>
                </div>

                <!-- URL Input -->
                <div class="flex gap-2">
                    <input type="text" id="url-input" placeholder="https://example.com/document.pdf" class="input-glass text-sm">
                    <button id="btn-load-url" class="btn-primary px-6">Buka</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Loading Overlay -->
    <div id="loading-overlay">
        <div class="loader"></div>
        <p class="text-xs tracking-widest text-sky-400 uppercase font-bold">Memproses Dokumen...</p>
    </div>

    <!-- Viewer Screen -->
    <div id="viewer-screen" class="hidden">
        <!-- Close Button (Back to Menu) -->
        <button id="btn-close-viewer" class="glass-panel fixed top-6 right-6 w-10 h-10 rounded-full flex items-center justify-center text-slate-400 hover:text-white transition-all z-[800]">
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>
        </button>

        <!-- Navigasi -->
        <button class="nav-btn prev" id="prev-page">
            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M15 19l-7-7 7-7"></path></svg>
        </button>
        <button class="nav-btn next" id="next-page">
            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M9 5l7 7-7 7"></path></svg>
        </button>

        <!-- Menu Anotasi -->
        <div id="annotation-container">
            <div id="btn-toggle-pen" class="glass-panel main-tool-btn text-sky-400" title="Alat Anotasi">
                <svg id="main-pen-icon" class="w-6 h-6 transition-colors" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z"></path>
                </svg>
            </div>
            
            <div id="color-palette" class="glass-panel">
                <button class="tool-btn active" id="btn-pan-mode" title="Mode Geser">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 11.5V14m0-2.5v-6a1.5 1.5 0 113 0V12m-3.5 0h4m-4 0a3 3 0 01-3-3V7a3 3 0 016 0v2.5"></path></svg>
                </button>
                <div class="h-px w-full bg-white/10 my-1"></div>
                <button class="tool-btn pen-selector" data-color="#ef4444" title="Merah">
                    <div class="pen-dot bg-red-500"></div>
                </button>
                <button class="tool-btn pen-selector" data-color="#3b82f6" title="Biru">
                    <div class="pen-dot bg-blue-500"></div>
                </button>
                <button class="tool-btn pen-selector" data-color="#22c55e" title="Hijau">
                    <div class="pen-dot bg-green-500"></div>
                </button>
                <button class="tool-btn pen-selector" data-color="#eab308" title="Kuning">
                    <div class="pen-dot bg-yellow-500"></div>
                </button>
                <div class="h-px w-full bg-white/10 my-1"></div>
                <button class="tool-btn text-slate-400 hover:text-red-400" id="btn-clear-draw" title="Hapus Coratan">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path></svg>
                </button>
            </div>
        </div>

        <!-- Paginasi -->
        <div id="pagination-panel" class="glass-panel">
            <span id="page-num" class="text-sky-400 font-bold">1</span>
            <span class="opacity-20 mx-2">/</span>
            <span id="page-count" class="opacity-60">0</span>
        </div>

        <!-- Menu Zoom -->
        <div id="zoom-menu" class="glass-panel">
            <button class="tool-btn" id="zoom-out"><svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20 12H4"></path></svg></button>
            <span id="zoom-percent" class="text-[10px] font-bold w-9 text-center opacity-50">100%</span>
            <button class="tool-btn" id="zoom-in"><svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path></svg></button>
            <div class="w-px h-4 bg-white/10 mx-1"></div>
            <button class="tool-btn" id="zoom-reset"><svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 8V4m0 0h4M4 4l5 5m11-1V4m0 0h-4m4 0l-5 5M4 16v4m0 0h4m-4 0l5-5m11 5l-5-5m5 5v-4m0 4h-4"></path></svg></button>
        </div>

        <!-- Viewer Area -->
        <div id="canvas-wrapper">
            <div id="canvas-track">
                <div class="slide" id="slide-1">
                    <div class="container-rel">
                        <canvas id="canvas-primary" class="pdf-canvas"></canvas>
                        <canvas id="draw-primary" class="draw-canvas"></canvas>
                    </div>
                </div>
                <div class="slide" id="slide-2">
                    <div class="container-rel">
                        <canvas id="canvas-secondary" class="pdf-canvas"></canvas>
                        <canvas id="draw-secondary" class="draw-canvas"></canvas>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        const pdfjsLib = window['pdfjs-dist/build/pdf'];
        pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js';

        let pdfDoc = null, pageNum = 1, isAnimating = false, currentZoom = 1.0; 
        let mode = 'pan', isDrawing = false, isDragging = false, penColor = '#38bdf8';
        let startX, startY, scrollLeft, scrollTop;
        let activeRenderTaskPrimary = null;

        // Elements
        const landingScreen = document.getElementById('landing-screen');
        const viewerScreen = document.getElementById('viewer-screen');
        const loadingOverlay = document.getElementById('loading-overlay');
        const track = document.getElementById('canvas-track');
        const wrapper = document.getElementById('canvas-wrapper');
        const slide1 = document.getElementById('slide-1');
        const slide2 = document.getElementById('slide-2');
        const pdfCanvas1 = document.getElementById('canvas-primary');
        const drawCanvas1 = document.getElementById('draw-primary');
        const pdfCanvas2 = document.getElementById('canvas-secondary');
        const drawCanvas2 = document.getElementById('draw-secondary');

        // Logic Pembukaan File
        document.getElementById('file-input').addEventListener('change', async (e) => {
            const file = e.target.files[0];
            if (file && file.type === 'application/pdf') {
                const reader = new FileReader();
                reader.onload = async function() {
                    const typedarray = new Uint8Array(this.result);
                    await initPdf(typedarray);
                };
                reader.readAsArrayBuffer(file);
            }
        });

        document.getElementById('btn-load-url').addEventListener('click', async () => {
            const url = document.getElementById('url-input').value.trim();
            if (url) await initPdf(url);
        });

        async function initPdf(source) {
            loadingOverlay.style.display = 'flex';
            try {
                // Reset State
                pageNum = 1;
                currentZoom = 1.0;
                
                pdfDoc = await pdfjsLib.getDocument(source).promise;
                document.getElementById('page-count').textContent = pdfDoc.numPages;
                document.getElementById('page-num').textContent = "1";
                
                landingScreen.style.display = 'none';
                viewerScreen.classList.remove('hidden');
                setAppMode('pan');
                slide1.style.zIndex = "100";
                
                // Clear drawings
                [drawCanvas1, drawCanvas2].forEach(c => c.getContext('2d').clearRect(0,0,c.width,c.height));
                
                await renderToCanvas(pageNum, pdfCanvas1, drawCanvas1);
            } catch (err) {
                console.error(err);
                alert("Gagal memuat PDF. Pastikan URL valid dan mendukung CORS (Cross-Origin Resource Sharing).");
            } finally {
                loadingOverlay.style.display = 'none';
            }
        }

        document.getElementById('btn-close-viewer').addEventListener('click', () => {
            viewerScreen.classList.add('hidden');
            landingScreen.style.display = 'flex';
            pdfDoc = null;
        });

        // Toggle Pen
        const btnTogglePen = document.getElementById('btn-toggle-pen');
        const colorPalette = document.getElementById('color-palette');
        const mainPenIcon = document.getElementById('main-pen-icon');
        const btnPanMode = document.getElementById('btn-pan-mode');

        btnTogglePen.addEventListener('click', () => colorPalette.classList.toggle('open'));

        function setAppMode(newMode, color = null) {
            mode = newMode;
            if (mode === 'pan') {
                updateToolUI(btnPanMode);
                [drawCanvas1, drawCanvas2].forEach(c => c.style.pointerEvents = 'none');
                wrapper.classList.add('cursor-pan');
                mainPenIcon.style.color = '#38bdf8';
            } else {
                if (color) penColor = color;
                [drawCanvas1, drawCanvas2].forEach(c => c.style.pointerEvents = 'auto');
                wrapper.classList.remove('cursor-pan');
                mainPenIcon.style.color = penColor;
            }
        }

        async function renderToCanvas(num, targetPdfCanvas, targetDrawCanvas) {
            if (!pdfDoc) return;
            if (targetPdfCanvas.id === 'canvas-primary' && activeRenderTaskPrimary) {
                activeRenderTaskPrimary.cancel();
            }

            const page = await pdfDoc.getPage(num);
            const availableWidth = window.innerWidth - 80;
            const fitScale = availableWidth / page.getViewport({ scale: 1 }).width;
            const finalScale = fitScale * currentZoom;
            const viewport = page.getViewport({ scale: finalScale });
            
            targetPdfCanvas.height = viewport.height;
            targetPdfCanvas.width = viewport.width;

            const renderTask = page.render({ 
                canvasContext: targetPdfCanvas.getContext('2d'), 
                viewport 
            });

            if (targetPdfCanvas.id === 'canvas-primary') activeRenderTaskPrimary = renderTask;

            try {
                await renderTask.promise;
            } catch (err) {
                if (err.name !== 'RenderingCancelledException') console.error(err);
            }

            targetDrawCanvas.width = viewport.width;
            targetDrawCanvas.height = viewport.height;
            document.getElementById('zoom-percent').textContent = Math.round(currentZoom * 100) + '%';
        }

        async function navigate(direction) {
            if (isAnimating || !pdfDoc) return;
            const nextNum = direction === 'next' ? pageNum + 1 : pageNum - 1;
            if (nextNum < 1 || nextNum > pdfDoc.numPages) return;

            isAnimating = true;
            wrapper.scrollTo(0, 0);

            if (direction === 'next') {
                slide1.style.zIndex = "1"; slide2.style.zIndex = "100";
                await renderToCanvas(nextNum, pdfCanvas2, drawCanvas2);
                drawCanvas2.getContext('2d').clearRect(0, 0, drawCanvas2.width, drawCanvas2.height);
                track.classList.add('transition-active');
                track.style.transform = 'translateX(-50%)';
            } else {
                slide1.style.zIndex = "100"; slide2.style.zIndex = "1";
                track.style.transform = 'translateX(-50%)';
                await renderToCanvas(nextNum, pdfCanvas1, drawCanvas1);
                drawCanvas1.getContext('2d').clearRect(0, 0, drawCanvas1.width, drawCanvas1.height);
                setTimeout(() => {
                    track.classList.add('transition-active');
                    track.style.transform = 'translateX(0%)';
                }, 20);
            }

            setTimeout(async () => {
                pageNum = nextNum;
                document.getElementById('page-num').textContent = pageNum;
                track.classList.remove('transition-active');
                track.style.transform = 'translateX(0%)';
                await renderToCanvas(pageNum, pdfCanvas1, drawCanvas1);
                slide1.style.zIndex = "100"; slide2.style.zIndex = "1";
                isAnimating = false;
            }, 510);
        }

        // Drawing Handlers
        function handleDrawStart(e, canvas) {
            if (mode !== 'draw') return;
            isDrawing = true;
            const ctx = canvas.getContext('2d');
            const rect = canvas.getBoundingClientRect();
            const x = (e.clientX || (e.touches && e.touches[0].clientX)) - rect.left;
            const y = (e.clientY || (e.touches && e.touches[0].clientY)) - rect.top;
            ctx.beginPath();
            ctx.moveTo(x, y);
            ctx.strokeStyle = penColor;
            ctx.lineWidth = 3; ctx.lineCap = 'round'; ctx.lineJoin = 'round';
        }

        function handleDrawMove(e, canvas) {
            if (!isDrawing || mode !== 'draw') return;
            const ctx = canvas.getContext('2d');
            const rect = canvas.getBoundingClientRect();
            const x = (e.clientX || (e.touches && e.touches[0].clientX)) - rect.left;
            const y = (e.clientY || (e.touches && e.touches[0].clientY)) - rect.top;
            ctx.lineTo(x, y); ctx.stroke();
        }

        function handleDrawEnd() { isDrawing = false; }

        [drawCanvas1, drawCanvas2].forEach(cvs => {
            cvs.addEventListener('mousedown', (e) => handleDrawStart(e, cvs));
            cvs.addEventListener('mousemove', (e) => handleDrawMove(e, cvs));
            window.addEventListener('mouseup', handleDrawEnd);
            cvs.addEventListener('touchstart', (e) => { if(mode === 'draw') e.preventDefault(); handleDrawStart(e, cvs); }, {passive: false});
            cvs.addEventListener('touchmove', (e) => { if(mode === 'draw') e.preventDefault(); handleDrawMove(e, cvs); }, {passive: false});
            cvs.addEventListener('touchend', handleDrawEnd);
        });

        // Pan/Drag Handler
        wrapper.addEventListener('mousedown', (e) => {
            if (mode !== 'pan') return;
            isDragging = true;
            startX = e.pageX - wrapper.offsetLeft;
            startY = e.pageY - wrapper.offsetTop;
            scrollLeft = wrapper.scrollLeft;
            scrollTop = wrapper.scrollTop;
            wrapper.classList.add('cursor-grabbing');
        });
        window.addEventListener('mouseup', () => { isDragging = false; wrapper.classList.remove('cursor-grabbing'); });
        window.addEventListener('mousemove', (e) => {
            if (!isDragging || mode !== 'pan') return;
            wrapper.scrollLeft = scrollLeft - (e.pageX - wrapper.offsetLeft - startX);
            wrapper.scrollTop = scrollTop - (e.pageY - wrapper.offsetTop - startY);
        });

        btnPanMode.addEventListener('click', () => { setAppMode('pan'); colorPalette.classList.remove('open'); });
        document.querySelectorAll('.pen-selector').forEach(btn => {
            btn.addEventListener('click', () => {
                setAppMode('draw', btn.getAttribute('data-color'));
                updateToolUI(btn);
            });
        });

        function updateToolUI(activeBtn) {
            document.querySelectorAll('.tool-btn').forEach(b => b.classList.remove('active'));
            document.querySelectorAll('.pen-dot').forEach(d => d.classList.remove('active'));
            activeBtn.classList.add('active');
            const dot = activeBtn.querySelector('.pen-dot');
            if (dot) dot.classList.add('active');
        }

        document.getElementById('btn-clear-draw').addEventListener('click', () => {
            [drawCanvas1, drawCanvas2].forEach(c => c.getContext('2d').clearRect(0, 0, c.width, c.height));
        });

        // Zoom Logic
        document.getElementById('zoom-in').addEventListener('click', () => { currentZoom += 0.2; renderToCanvas(pageNum, pdfCanvas1, drawCanvas1); });
        document.getElementById('zoom-out').addEventListener('click', () => { if(currentZoom > 0.4) currentZoom -= 0.2; renderToCanvas(pageNum, pdfCanvas1, drawCanvas1); });
        document.getElementById('zoom-reset').addEventListener('click', () => { currentZoom = 1.0; renderToCanvas(pageNum, pdfCanvas1, drawCanvas1); });

        // Pagination Buttons
        document.getElementById('prev-page').addEventListener('click', () => navigate('prev'));
        document.getElementById('next-page').addEventListener('click', () => navigate('next'));

        // Keyboard Shortcuts
        window.addEventListener('keydown', (e) => {
            if (viewerScreen.classList.contains('hidden')) return;
            if (e.key === 'ArrowLeft') navigate('prev');
            else if (e.key === 'ArrowRight' || e.key === ' ') navigate('next');
        });

        window.addEventListener('resize', () => { if (pdfDoc) renderToCanvas(pageNum, pdfCanvas1, drawCanvas1); });
    </script>
</body>
</html>
